<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Mentor – Timetable</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="public/css/base.css" />
  <link rel="stylesheet" href="public/css/layout.css" />
  <link rel="stylesheet" href="public/css/components.css" />
</head>
<body>
  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar" role="navigation" aria-label="Main navigation">
      <div class="sidebar__header">
        <div class="sidebar__brand">
          <svg class="sidebar__brand-icon" width="32" height="32" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg>
          <div class="sidebar__brand-text"><h1 class="sidebar__brand-title">Smart Mentor</h1><span class="sidebar__brand-subtitle">Academic Companion</span></div>
        </div>
        <button class="sidebar__toggle" id="sidebar-toggle" aria-label="Toggle sidebar" aria-expanded="true" aria-controls="sidebar"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
      </div>
      <nav class="sidebar__nav">
        <ul class="sidebar__nav-list" role="list">
          <li class="sidebar__nav-item"><a href="index.html" class="sidebar__nav-link"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg><span>Dashboard</span></a></li>
          <li class="sidebar__nav-item"><a href="assignments.html" class="sidebar__nav-link"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg><span>Assignments</span></a></li>
          <li class="sidebar__nav-item"><a href="timetable.html" class="sidebar__nav-link sidebar__nav-link--active"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg><span>Timetable</span></a></li>
          <li class="sidebar__nav-item"><a href="progress.html" class="sidebar__nav-link"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg><span>Progress</span></a></li>
          <li class="sidebar__nav-item"><a href="calendar.html" class="sidebar__nav-link"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line><rect x="7" y="14" width="3" height="3"></rect></svg><span>Calendar</span></a></li>
          <li class="sidebar__nav-item"><a href="subjects.html" class="sidebar__nav-link"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6l4 2"></path></svg><span>Subjects</span></a></li>
          <li class="sidebar__nav-item"><a href="learning-path.html" class="sidebar__nav-link"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M3 3h18v4H3z"></path><path d="M7 7v14"></path></svg><span>Learning Path</span></a></li>
          <li class="sidebar__nav-item"><a href="assessment.html" class="sidebar__nav-link"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><rect x="3" y="3" width="18" height="14" rx="2"></rect><path d="M7 7h10M7 11h6"></path></svg><span>Assessment</span></a></li>
          <li class="sidebar__nav-item"><a href="analytics.html" class="sidebar__nav-link"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg><span>Analytics</span></a></li>
          <li class="sidebar__nav-item"><a href="ai-mentor.html" class="sidebar__nav-link"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg><span>AI Mentor</span></a></li>
        </ul>
      </nav>
      <div class="sidebar__footer">
        <button class="sidebar__action-button chatbot-trigger-button" id="chatbot-trigger" aria-label="Open AI mentor chat"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg><span>AI Mentor</span><span class="sidebar__notification-badge" id="chat-notification" aria-label="Unread messages"></span></button>
        <div class="sidebar__user"><div class="sidebar__user-avatar" aria-hidden="true"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></div><div class="sidebar__user-info"><span class="sidebar__user-name">Student</span><span class="sidebar__user-role">Active</span></div></div>
      </div>
    </aside>

    <!-- Main -->
    <div class="main-wrapper">
      <header class="dashboard-header" role="banner">
        <div class="dashboard-header__content">
          <div class="dashboard-header__title-section">
            <h1 class="dashboard-header__title">Timetable</h1>
            <p class="dashboard-header__subtitle">View your weekly schedule.</p>
          </div>
          <div class="dashboard-header__actions">
            <button class="primary-button" id="add-task" aria-label="Add new task"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg><span>Add Task</span></button>
            <div class="progress-view-toggle" role="group" aria-label="Period selector">
              <button class="progress-view-toggle__button progress-view-toggle__button--active" data-view="weekly" aria-pressed="true">Weekly</button>
              <button class="progress-view-toggle__button" data-view="monthly" aria-pressed="false">Monthly</button>
              <button class="progress-view-toggle__button" data-view="yearly" aria-pressed="false">Yearly</button>
            </div>
          </div>
        </div>
      </header>

      <main class="dashboard-content" role="main">
        <div class="dashboard-grid">
          <section class="dashboard-card dashboard-card--timetable" aria-labelledby="timetableTitle" data-component="timetable">
            <div class="dashboard-card__header">
              <div class="dashboard-card__title-group">
                <h2 class="dashboard-card__title" id="timetableTitle">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="9" y1="3" x2="9" y2="21"></line></svg>
                  Weekly Timetable
                </h2>
                <span class="dashboard-card__badge" data-current-day>Today</span>
              </div>
            </div>
            <div class="dashboard-card__content">
              <div class="timetable-editor" data-timetable-container>
                <div class="timetable-toolbar" aria-label="Timetable controls">
                  <div class="timetable-controls">
                    <div class="timetable-filters">
                      <label class="sr-only" for="timetable-day-filter">Filter by day</label>
                      <select id="timetable-day-filter" aria-label="Filter by day">
                        <option value="all">All days</option>
                        <option value="monday">Monday</option>
                        <option value="tuesday">Tuesday</option>
                        <option value="wednesday">Wednesday</option>
                        <option value="thursday">Thursday</option>
                        <option value="friday">Friday</option>
                        <option value="saturday">Saturday</option>
                        <option value="sunday">Sunday</option>
                      </select>
                      <label class="sr-only" for="timetable-subject-filter">Filter by subject</label>
                      <input id="timetable-subject-filter" type="search" placeholder="Filter by subject" aria-label="Filter by subject" />
                      <button class="icon-button" id="timetable-clear-filters" title="Clear filters" aria-label="Clear filters">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                      </button>
                    </div>
                    <div class="timetable-actions">
                      <div class="progress-view-toggle" id="timetable-density-toggle" role="group" aria-label="Row density">
                        <button class="progress-view-toggle__button" data-density="compact" aria-pressed="false">Compact</button>
                        <button class="progress-view-toggle__button progress-view-toggle__button--active" data-density="expanded" aria-pressed="true">Comfortable</button>
                      </div>
                      <button class="secondary-button" id="add-block-global" aria-label="Add time block">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        <span>Add Block</span>
                      </button>
                    </div>
                  </div>
                  <div class="timetable-keyboard-help" role="note">Drag to move/resize. Keyboard: Alt + Left/Right = move by 15m; Shift + Left/Right = resize; Alt + Up/Down = move day; Enter to edit; Delete removes; Ctrl/Cmd + D duplicates.</div>
                </div>
                <div id="timetable-grid" class="timetable-grid" role="grid" aria-label="Weekly timetable"></div>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>
  </div>

  <button id="add-task-fab" aria-label="Add Task" title="Add Task"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg><span class="sr-only">Add Task</span></button>

  <!-- Chatbot + Modals -->
  <div id="chatbot-modal" class="chatbot-modal" role="dialog" aria-labelledby="chatbot-title" aria-modal="true" hidden>
    <div class="chatbot-container chatbot-modal__container">
      <div class="chatbot-header chatbot-modal__header">
        <div class="chatbot-title-section chatbot-modal__title-section"><div class="mentor-avatar chatbot-modal__avatar"><svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg></div><div><h2 id="chatbot-title">Smart Mentor</h2><span class="chatbot-status chatbot-modal__status">Online</span></div></div>
        <div class="chatbot-header__actions"><button id="reset-chat" class="icon-button chatbot-modal__reset-button" aria-label="Reset conversation"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg></button><button id="close-chatbot" class="close-button chatbot-modal__close-button" aria-label="Close chatbot"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div>
      </div>
      <div id="chatbot-messages" class="chatbot-messages chatbot-modal__messages" role="log" aria-live="polite" aria-atomic="false"></div>
      <div id="chat-aria-live" class="sr-only" aria-live="polite" aria-atomic="true"></div>
      <div class="chatbot-input-container chatbot-modal__input-container">
        <form id="chatbot-form" class="chatbot-input-form chatbot-modal__form">
          <textarea id="chatbot-input" class="chatbot-input chatbot-modal__input" placeholder="Type your message..." rows="1" aria-label="Chat message input" autocomplete="off"></textarea>
          <button type="submit" id="send-button" class="send-button chatbot-modal__send-button" aria-label="Send message" disabled><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></button>
        </form>
      </div>
    </div>
  </div>
  <div id="chatbot-overlay" class="chatbot-overlay" hidden></div>

  <div id="task-modal-overlay" class="modal-overlay" hidden></div>
  <div id="task-form-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="task-form-title" hidden>
    <div class="modal-content"><div class="modal-header"><h2 id="task-form-title">Add Task</h2><button type="button" class="icon-button modal-close" data-close-modal="task-form-modal" aria-label="Close task form"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div><form id="task-form" class="modal-form"><input type="hidden" id="task-form-id"><div class="form-group"><label for="task-form-title-input">Title</label><input id="task-form-title-input" name="title" type="text" required placeholder="Enter task title"></div><div class="form-group"><label for="task-form-description">Description</label><textarea id="task-form-description" name="description" rows="3" placeholder="Add details or requirements"></textarea></div><div class="form-row"><div class="form-group"><label for="task-form-subject">Subject</label><input id="task-form-subject" name="subject" type="text" placeholder="e.g., Calculus"></div><div class="form-group"><label for="task-form-due-date">Due Date</label><input id="task-form-due-date" name="dueDate" type="date"></div></div><div class="form-row"><div class="form-group"><label for="task-form-priority">Priority</label><select id="task-form-priority" name="priority" required><option value="high">High</option><option value="medium">Medium</option><option value="low">Low</option></select></div><div class="form-group"><label for="task-form-progress">Progress</label><div class="progress-input"><input id="task-form-progress" name="progress" type="range" min="0" max="100" step="5" value="0"><span id="task-form-progress-value">0%</span></div></div></div><div class="modal-actions"><button type="button" class="secondary-button" data-close-modal="task-form-modal">Cancel</button><button type="submit" class="primary-button" id="task-form-submit">Save Task</button></div></form></div>
  </div>

  <div id="day-detail-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="day-detail-title" hidden>
    <div class="modal-content"><div class="modal-header"><h2 id="day-detail-title">Day Summary</h2><button type="button" class="icon-button modal-close" data-close-modal="day-detail-modal" aria-label="Close day details"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div><div class="modal-body"><p id="day-detail-date">—</p></div><div class="modal-actions"><button type="button" class="secondary-button" disabled>Add Event (stub)</button><button type="button" class="primary-button" data-close-modal="day-detail-modal">Close</button></div></div>
  </div>

  <!-- Timetable block modals -->
  <div id="timetable-block-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="timetable-block-title" hidden>
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="timetable-block-title">Edit Time Block</h2>
        <button type="button" class="icon-button modal-close" data-close-modal="timetable-block-modal" aria-label="Close block editor"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
      </div>
      <form id="timetable-block-form" class="modal-form">
        <input type="hidden" id="block-form-id" />
        <div class="form-row">
          <div class="form-group">
            <label for="block-form-day">Day</label>
            <select id="block-form-day" required>
              <option value="monday">Monday</option>
              <option value="tuesday">Tuesday</option>
              <option value="wednesday">Wednesday</option>
              <option value="thursday">Thursday</option>
              <option value="friday">Friday</option>
              <option value="saturday">Saturday</option>
              <option value="sunday">Sunday</option>
            </select>
          </div>
          <div class="form-group">
            <label for="block-form-color">Color</label>
            <input type="color" id="block-form-color" value="#2563eb" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="block-form-start">Start</label>
            <input id="block-form-start" type="time" required />
          </div>
          <div class="form-group">
            <label for="block-form-end">End</label>
            <input id="block-form-end" type="time" required />
          </div>
        </div>
        <div class="form-group">
          <label for="block-form-subject">Subject</label>
          <input id="block-form-subject" type="text" required placeholder="e.g., Calculus" />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="block-form-location">Location</label>
            <input id="block-form-location" type="text" placeholder="Room or location" />
          </div>
          <div class="form-group">
            <label for="block-form-notes">Notes</label>
            <input id="block-form-notes" type="text" placeholder="Optional notes" />
          </div>
        </div>
        <div class="modal-actions">
          <button type="button" class="secondary-button" data-close-modal="timetable-block-modal">Cancel</button>
          <button type="submit" class="primary-button">Save</button>
        </div>
      </form>
    </div>
  </div>

  <div id="timetable-delete-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="timetable-delete-title" hidden>
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="timetable-delete-title">Delete Time Block</h2>
        <button type="button" class="icon-button modal-close" data-close-modal="timetable-delete-modal" aria-label="Close delete confirmation"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this time block?</p>
      </div>
      <div class="modal-actions">
        <button type="button" class="secondary-button" data-close-modal="timetable-delete-modal">Cancel</button>
        <button type="button" id="confirm-delete-block" class="danger-button">Delete</button>
      </div>
    </div>
  </div>

  <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

  <script src="public/js/api.js"></script>
  <script src="public/js/chatbot.js"></script>
  <script src="script.js"></script>
  <script src="public/js/modules/utils.js"></script>
  <script src="public/js/modules/nav.js"></script>
  <script src="public/js/modules/timetable.js"></script>
  <script src="public/js/modules/main.js"></script>
</body>
</html>